---
abbrlink: ''
categories:
- - 网络安全
date: '2024-01-05T22:57:59.050663+08:00'
excerpt: CSRF安全漏洞 跨站请求伪造（CSRF）是一种网络安全漏洞，它允许攻击者利用已通过身份验证的用户的权限来执行未经授权的操作。攻击者通过欺骗用户使其在受信任的网站上执行恶意操作，从而触发已登录用户的请...
tags:
- CSRF
title: CSRF安全漏洞
updated: '2024-01-05T23:24:41.070+08:00'
---
# CSRF安全漏洞

## 跨站请求伪造（CSRF）是一种网络安全漏洞，它允许攻击者利用已通过身份验证的用户的权限来执行未经授权的操作。攻击者通过欺骗用户使其在受信任的网站上执行恶意操作，从而触发已登录用户的请求。以下是有关CSRF攻击的一些基本信息和防范方法

### 漏洞原理

1. **用户已登录：** 攻击者利用用户已登录到目标网站的事实。
2. **恶意请求：** 攻击者构造一个包含恶意操作的请求，例如改变用户密码、发起转账等。
3. **伪装请求：** 攻击者将构造的请求嵌入到欺骗性的页面或社交工程攻击中，引导用户在不知情的情况下执行操作。
4. **自动执行：** 用户在未察觉的情况下，浏览器会自动发送已登录用户的凭证（cookie等），触发恶意请求。

假设有一个在线银行网站，用户在登录后可以执行转账操作。以下是一个简化的CSRF攻击的例子：

1. **用户登录银行账户：**
    - 用户A在银行网站登录，服务器会颁发一个包含用户身份验证信息的Cookie。

2. **攻击者构造恶意页面：**
    - 攻击者创建了一个恶意网站，并在该网站上放置了一个恶意的HTML表单，其中包含了银行网站的转账请求，但是用户并不知晓。

    ```html
    <html>
    <body>
        <form action="https://bank.com/transfer" method="post">
        <input type="hidden" name="toAccount" value="attackerAccount">
        <input type="hidden" name="amount" value="1000000">
        <!-- CSRF攻击的关键：攻击者欺骗用户在不知情的情况下提交该表单 -->
        <input type="submit" value="点击这里获取免费游戏">
        </form>
    </body>
    </html>
    ```

3. **用户被欺骗执行操作：**
    - 攻击者通过社交工程或其他手段诱导用户A访问他们的网站，用户A在不知情的情况下点击了表单中的按钮。

4. **恶意请求被发送：**
    - 由于用户A已在银行网站登录，浏览器会自动发送包含用户身份验证信息的Cookie的POST请求，执行转账操作。

5. **攻击成功：**
    - 用户A的银行账户从银行网站上被悄无声息地转账了一笔金额到攻击者指定的账户。

这个例子展示了CSRF攻击的基本原理，即攻击者利用用户已登录的状态，通过欺骗用户使其执行未经授权的操作。通过实施CSRF令牌等防范措施，可以有效地减轻这类攻击的影响。

### 防范方法

1. **同源策略：** 保持网站的同源策略，限制页面只能加载来自相同域的资源，减少恶意站点的能力。
    同源策略主要由浏览器通过比较页面的来源（Origin）来判断。具体来说，同源策略检查的字段是页面的来源信息，即包含协议、域名和端口号的组合。

    在浏览器中，`Origin`头字段用于表示请求的来源。`Origin`头的值包含协议、域名和端口号。例如，一个`Origin`头可能是：

    ```code
    https://www.example.com:443
    ```

    同源策略比较两个页面的`Origin`头，只有当它们的协议、域名和端口号完全相同时，这两个页面才被认为是同源的。

    如果页面之间的`Origin`头不同，浏览器会根据同源策略阻止一些敏感操作，如使用JavaScript在一个页面中访问另一个页面的DOM、Cookie或发起跨域的XMLHttpRequest请求。

    这种限制有助于减少跨站点攻击，如跨站请求伪造（CSRF）和跨站脚本攻击（XSS），提高了用户的安全性和隐私保护。如果需要实现跨域操作，可以使用CORS（Cross-Origin Resource Sharing）等机制进行授权和访问控制。
2. **CSRF令牌：** 在用户与服务器之间引入CSRF令牌，确保每个请求都包含一个仅服务器能够验证的唯一标识符。
3. **双重提交Cookie：** 在用户的cookie中设置一个随机的令牌，并将该令牌作为表单字段和cookie的一部分一同提交。
4. **Referer检查：** 服务器可以检查请求的Referer头部，确保请求是从合法的网站发起的。
5. **自定义Header：** 在请求中使用自定义的HTTP头部，只有合法的请求才会包含这个头部。
6. **限制敏感操作：** 敏感操作（如修改密码、转账等）应该要求用户重新验证身份，例如输入密码。
7. **使用SameSite Cookie属性：** 将Cookie的SameSite属性设置为Strict或Lax，以限制Cookie的发送，防止跨站请求。
8. **定期更改令牌：** 如果令牌长时间有效，攻击者有更多机会截获和滥用。因此，定期更改令牌可以增加安全性。

这些防范方法通常结合使用，以提高对CSRF攻击的抵抗力。网站开发者应当审查其应用程序的安全性，并在可能的情况下实施这些防范措施。
